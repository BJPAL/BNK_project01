<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>자주 묻는 질문</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #fafafa;
      padding: 40px;
      text-align: center;
    }

    h1 {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 20px;
    }

    .search-box {
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f1f3f5;
      border-radius: 30px;
      width: 400px;
      margin: 0 auto 30px auto;
      padding: 5px 15px;
    }

    .search-box input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 14px;
      padding: 8px;
      outline: none;
    }

    .search-box button {
      background: none;
      border: none;
      cursor: pointer;
    }

    .search-box button img {
      width: 20px;
      height: 20px;
    }

    #faq-list {
      max-width: 600px;
      margin: 0 auto;
      text-align: left;
      list-style: none;
      padding: 0;
    }

    #faq-list li {
      background: #fff;
      border-bottom: 1px solid #ddd;
      padding: 15px;
      cursor: pointer;
      transition: background 0.2s;
    }

    #faq-list li:hover {
      background: #f8f9fa;
    }

    .question {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 500;
      position: relative;
      padding-right: 24px;
    }

    .question::after {
      content: "";
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%) rotate(0deg);
      width: 16px;
      height: 16px;
      background-image: url('images/toggle_icon.png'); /* 펼침/접힘 아이콘 */
      background-size: contain;
      background-repeat: no-repeat;
      transition: transform 0.2s ease;
    }

    .question.open::after {
      transform: translateY(-50%) rotate(180deg);
    }

    .answer {
      display: none;
      padding-top: 10px;
      font-size: 14px;
      color: #333;
    }
  </style>
</head>
<body>

  <h1>자주 묻는 질문</h1>

  <form class="search-box" onsubmit="event.preventDefault(); searchFaq();">
    <input type="text" id="keyword" placeholder="검색어를 입력해주세요">
    <button type="submit">
      <img src="images/search_icon.png" alt="검색">
    </button>
  </form>

  <ul id="faq-list"/>
  </ul>
  
  <div id="pagination" class="pagination"></div>

  <script>
  let currentKeyword = ""; // 검색어
  let currentPage = 0; // 현재 페이지 번호

  function answerToggle() {
    document.querySelectorAll(".question").forEach(q => {
      q.addEventListener("click", function () {
        const answer = this.nextElementSibling;
        const isOpen = this.classList.toggle('open');
        answer.style.display = isOpen ? 'block' : 'none';
      });
    });
  }

  function searchFaq(page = 0) {
    currentKeyword = document.getElementById("keyword").value;
    currentPage = page;

    fetch(`/searchFaq?keyword=${encodeURIComponent(currentKeyword)}&page=${page}&size=10`)
      .then(res => res.json())
      .then(data => {
        const ul = document.getElementById("faq-list");
        ul.innerHTML = '';

        data.content.forEach(faq => {
          const li = document.createElement('li');
          li.innerHTML = `
            <div class="question">Q ${faq.question}</div>
            <div class="answer" style="display:none;">A ${faq.answer}</div>
          `;
          ul.appendChild(li);
        });

        renderPagination(data.totalPages, data.currentPage);
        answerToggle();
      })
      .catch(error => {
        console.error("FAQ 검색 중 오류:", error);
      });
  }

  function renderPagination(totalPages, currentPage) {
    const pagination = document.getElementById("pagination");
    pagination.innerHTML = '';

    for (let i = 0; i < totalPages; i++) {
      const btn = document.createElement("button");
      btn.textContent = i + 1;
      btn.disabled = (i === currentPage);
      btn.addEventListener("click", () => searchFaq(i));
      pagination.appendChild(btn);
    }
  }

  // 초기 로딩
  document.addEventListener("DOMContentLoaded", () => {
    searchFaq(); // 초기 FAQ 목록 + 페이지네이션
  });
</script>

</body>
</html>
