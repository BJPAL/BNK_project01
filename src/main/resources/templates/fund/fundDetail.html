<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/css/fund/fund_detail.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
        <title>펀드 상세 정보</title>
    </head>
    <body>
        <div class="container">
            <!-- 페이지 제목 영역 -->
            <div class="page-title-container">
                <h1 class="page-title">펀드 상세</h1>
            </div>

            <!-- 에러 표시 -->
            <!-- 
                <div id="error" class="error hidden">
                    <p id="error-message">오류가 발생했습니다.</p>
                </div>
            -->

            <!-- ── 로딩 오버레이 ── -->
            <!-- 
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>펀드 정보를 불러오는 중...</p>
                </div>
            -->

            <!-- 펀드 상세 컨테이너 -->
            <div id="fund-detail-container" class="fund-detail-container">
                <!-- 펀드명 -->
                <div class="fund-item-container">
                    <h2 class="item-title">펀드명</h2>
                    <span id="fund-name" class="fund-name">
                        KB뱅크이기즐겁다운용전문투자신탁(주식)
                    </span>
                </div>

                <!-- 펀드 상세 정보 -->
                <div class="fund-item-container">
                    <h2 class="item-title">펀드 상세 정보</h2>
                    <table class="fund-info-table">
                        <tr>
                            <th>펀드 유형</th>
                            <td>주식형</td>
                            <th>운용회사</th>
                            <td>KB자산운용</td>
                        </tr>
                        <tr>
                            <th>투자 지역</th>
                            <td>한국</td>
                            <th>위험 등급</th>
                            <td>
                                <span class="risk-level risk-2"
                                    >2등급 (높은 위험)</span
                                >
                            </td>
                        </tr>
                        <tr>
                            <th>설정일</th>
                            <td>2009. 11. 9.</td>
                            <th>출범일</th>
                            <td>2021. 11. 16.</td>
                        </tr>
                        <tr>
                            <th>기준가</th>
                            <td>965원</td>
                            <th>순자산</th>
                            <td>16억원</td>
                        </tr>
                        <tr>
                            <th>총 보수율</th>
                            <td>1.13%</td>
                            <td colspan="2"></td>
                        </tr>
                    </table>
                </div>

                <!-- 펀드 수익률 -->
                <div class="fund-item-container">
                    <h2 class="item-title">펀드 수익률 정보</h2>
                    <canvas id="fundChart"></canvas>
                    <div class="fund-return-container"></div>
                </div>

                <!-- 펀드 포트폴리오 -->
                <div class="fund-item-container">
                    <h2 class="item-title">펀드 포트폴리오</h2>
                    <table class="portfolio-table" id="portfolioTable">
                        <thead>
                            <tr>
                                <th>구분</th>
                                <th>국내주식</th>
                                <th>해외주식</th>
                                <th>국내채권</th>
                                <th>해외채권</th>
                                <th>펀드투자</th>
                                <th>유동성</th>
                            </tr>
                        </thead>
                        <tbody id="portfolioTableBody">
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    국내주식형펀드A
                                </td>
                                <td>99.50%</td>
                                <td>0.00%</td>
                                <td>0.00%</td>
                                <td>0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage low">0.48%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    해외주식형펀드B
                                </td>
                                <td class="percentage low">2.10%</td>
                                <td class="percentage high">91.01%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage low">5.78%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    국내채권형펀드C
                                </td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage high">97.19%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage low">3.57%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    해외채권형펀드D
                                </td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage high">85.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage low">13.70%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    혼합형펀드E
                                </td>
                                <td class="percentage medium">45.20%</td>
                                <td class="percentage medium">25.30%</td>
                                <td class="percentage low">15.50%</td>
                                <td class="percentage low">8.20%</td>
                                <td class="percentage low">3.50%</td>
                                <td class="percentage low">2.30%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    균형형펀드F
                                </td>
                                <td class="percentage medium">35.80%</td>
                                <td class="percentage low">15.40%</td>
                                <td class="percentage medium">30.20%</td>
                                <td class="percentage low">12.60%</td>
                                <td class="percentage low">4.20%</td>
                                <td class="percentage low">1.80%</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="fund-portfolio-container"></div>
                </div>
            </div>

            <!-- 버튼 영역 -->
            <div class="button-container">
                <button class="page-btn btn-secondary">목록으로</button>
                <button class="page-btn btn-primary">가입하기</button>
            </div>
        </div>
    </body>

    <script>
        // 단일 펀드 수익률 데이터 (음수 포함 예시)
        const fundData = {
            name: "삼성증권투자신탁",
            return_1m: -2.15, // 음수 예시
            return_3m: 15.42,
            return_6m: -5.23, // 음수 예시
            return_12m: 8.75,
        };

        let chart;

        // 수익률에 따른 색상 결정 (양수=파란색, 음수=빨간색)
        function getColor(value) {
            if (value >= 0) {
                return "rgba(54, 162, 235, 0.8)"; // 양수 - 파란색
            } else {
                return "rgba(255, 99, 132, 0.8)"; // 음수 - 빨간색
            }
        }

        // 테두리 색상 (배경색보다 진하게)
        function getBorderColor(value) {
            if (value >= 0) {
                return "rgba(54, 162, 235, 1)"; // 양수 - 진한 파란색
            } else {
                return "rgba(255, 99, 132, 1)"; // 음수 - 진한 빨간색
            }
        }

        // 차트 초기화
        function initChart() {
            const ctx = document.getElementById("fundChart").getContext("2d");

            const returns = [
                fundData.return_1m,
                fundData.return_3m,
                fundData.return_6m,
                fundData.return_12m,
            ];

            chart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: ["1개월", "3개월", "6개월", "12개월"],
                    datasets: [
                        {
                            label: "수익률 (%)",
                            data: returns,
                            backgroundColor: returns.map(getColor),
                            borderColor: returns.map(getBorderColor),
                            barPercentage: 0.5, // 막대 너비 비율 (0-1)
                            borderSkipped: "bottom",
                            // borderWidth: 2,
                            // borderRadius: 4,
                            // borderSkipped: false,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: "기간별 수익률 (%)",
                            font: {
                                size: 16,
                                weight: "bold",
                            },
                            padding: {
                                top: 10,
                                bottom: 20,
                            },
                        },
                        legend: {
                            display: false, // 단일 데이터셋이므로 범례 숨김
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const value = context.parsed.y;
                                    return `수익률: ${
                                        value >= 0 ? "+" : ""
                                    }${value.toFixed(2)}%`;
                                },
                                afterLabel: function (context) {
                                    const value = context.parsed.y;
                                    if (value > 0) return "🔵 수익";
                                    if (value < 0) return "🔴 손실";
                                    return "➖ 변동 없음";
                                },
                            },
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: "수익률 (%)",
                                font: {
                                    size: 14,
                                    weight: "bold",
                                },
                            },
                            grid: {
                                color: "rgba(0,0,0,0.1)",
                                drawBorder: false,
                            },
                            ticks: {
                                callback: function (value) {
                                    return value + "%";
                                },
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: "투자 기간",
                                font: {
                                    size: 14,
                                    weight: "bold",
                                },
                            },
                            grid: {
                                display: false,
                            },
                        },
                    },
                    animation: {
                        duration: 1500,
                        easing: "easeInOutQuart",
                    },
                    interaction: {
                        intersect: false,
                        mode: "index",
                    },
                },
            });
        }

        // 실제 데이터로 차트 업데이트하는 함수
        function updateChart(newFundData) {
            const returns = [
                newFundData.return_1m || newFundData.return1m,
                newFundData.return_3m || newFundData.return3m,
                newFundData.return_6m || newFundData.return6m,
                newFundData.return_12m || newFundData.return12m,
            ];

            // 펀드 정보 업데이트
            document.getElementById("fundInfo").textContent = `펀드명: ${
                newFundData.name || newFundData.fundName || "펀드"
            }`;

            // 차트 데이터 업데이트
            chart.data.datasets[0].data = returns;
            chart.data.datasets[0].backgroundColor = returns.map(getColor);
            chart.data.datasets[0].borderColor = returns.map(getBorderColor);

            chart.update("active");
        }

        // 페이지 로드 시 차트 초기화
        window.onload = function () {
            initChart();
        };

        // 외부에서 사용할 수 있는 전역 함수
        window.updateFundChart = updateChart;
    </script>
</html>
