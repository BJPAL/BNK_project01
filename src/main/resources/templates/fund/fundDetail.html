<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/css/fund/fund_detail.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
        <title>ν€λ“ μƒμ„Έ μ •λ³΄</title>
    </head>
    <body>
        <div class="container">
            <!-- νμ΄μ§€ μ λ© μμ—­ -->
            <div class="page-title-container">
                <h1 class="page-title">ν€λ“ μƒμ„Έ</h1>
            </div>

            <!-- μ—λ¬ ν‘μ‹ -->
            <!-- 
                <div id="error" class="error hidden">
                    <p id="error-message">μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.</p>
                </div>
            -->

            <!-- β”€β”€ λ΅λ”© μ¤λ²„λ μ΄ β”€β”€ -->
            <!-- 
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>ν€λ“ μ •λ³΄λ¥Ό λ¶λ¬μ¤λ” μ¤‘...</p>
                </div>
            -->

            <!-- ν€λ“ μƒμ„Έ μ»¨ν…μ΄λ„ -->
            <div id="fund-detail-container" class="fund-detail-container">
                <!-- ν€λ“λ… -->
                <div class="fund-item-container">
                    <h2 class="item-title">ν€λ“λ…</h2>
                    <span id="fund-name" class="fund-name">
                        KBλ±…ν¬μ΄κΈ°μ¦κ²λ‹¤μ΄μ©μ „λ¬Έν¬μμ‹ νƒ(μ£Όμ‹)
                    </span>
                </div>

                <!-- ν€λ“ μƒμ„Έ μ •λ³΄ -->
                <div class="fund-item-container">
                    <h2 class="item-title">ν€λ“ μƒμ„Έ μ •λ³΄</h2>
                    <table class="fund-info-table">
                        <tr>
                            <th>ν€λ“ μ ν•</th>
                            <td>μ£Όμ‹ν•</td>
                            <th>μ΄μ©νμ‚¬</th>
                            <td>KBμμ‚°μ΄μ©</td>
                        </tr>
                        <tr>
                            <th>ν¬μ μ§€μ—­</th>
                            <td>ν•κµ­</td>
                            <th>μ„ν— λ“±κΈ‰</th>
                            <td>
                                <span class="risk-level risk-2"
                                    >2λ“±κΈ‰ (λ†’μ€ μ„ν—)</span
                                >
                            </td>
                        </tr>
                        <tr>
                            <th>μ„¤μ •μΌ</th>
                            <td>2009. 11. 9.</td>
                            <th>μ¶λ²”μΌ</th>
                            <td>2021. 11. 16.</td>
                        </tr>
                        <tr>
                            <th>κΈ°μ¤€κ°€</th>
                            <td>965μ›</td>
                            <th>μμμ‚°</th>
                            <td>16μ–µμ›</td>
                        </tr>
                        <tr>
                            <th>μ΄ λ³΄μμ¨</th>
                            <td>1.13%</td>
                            <td colspan="2"></td>
                        </tr>
                    </table>
                </div>

                <!-- ν€λ“ μμµλ¥  -->
                <div class="fund-item-container">
                    <h2 class="item-title">ν€λ“ μμµλ¥  μ •λ³΄</h2>
                    <canvas id="fundChart"></canvas>
                    <div class="fund-return-container"></div>
                </div>

                <!-- ν€λ“ ν¬νΈν΄λ¦¬μ¤ -->
                <div class="fund-item-container">
                    <h2 class="item-title">ν€λ“ ν¬νΈν΄λ¦¬μ¤</h2>
                    <table class="portfolio-table" id="portfolioTable">
                        <thead>
                            <tr>
                                <th>κµ¬λ¶„</th>
                                <th>κµ­λ‚΄μ£Όμ‹</th>
                                <th>ν•΄μ™Έμ£Όμ‹</th>
                                <th>κµ­λ‚΄μ±„κ¶</th>
                                <th>ν•΄μ™Έμ±„κ¶</th>
                                <th>ν€λ“ν¬μ</th>
                                <th>μ λ™μ„±</th>
                            </tr>
                        </thead>
                        <tbody id="portfolioTableBody">
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    κµ­λ‚΄μ£Όμ‹ν•ν€λ“A
                                </td>
                                <td>99.50%</td>
                                <td>0.00%</td>
                                <td>0.00%</td>
                                <td>0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage low">0.48%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    ν•΄μ™Έμ£Όμ‹ν•ν€λ“B
                                </td>
                                <td class="percentage low">2.10%</td>
                                <td class="percentage high">91.01%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage low">5.78%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    κµ­λ‚΄μ±„κ¶ν•ν€λ“C
                                </td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage high">97.19%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage low">3.57%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    ν•΄μ™Έμ±„κ¶ν•ν€λ“D
                                </td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage high">85.00%</td>
                                <td class="zero-value">0.00%</td>
                                <td class="percentage low">13.70%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    νΌν•©ν•ν€λ“E
                                </td>
                                <td class="percentage medium">45.20%</td>
                                <td class="percentage medium">25.30%</td>
                                <td class="percentage low">15.50%</td>
                                <td class="percentage low">8.20%</td>
                                <td class="percentage low">3.50%</td>
                                <td class="percentage low">2.30%</td>
                            </tr>
                            <tr>
                                <td style="text-align: left; font-weight: 500">
                                    κ· ν•ν•ν€λ“F
                                </td>
                                <td class="percentage medium">35.80%</td>
                                <td class="percentage low">15.40%</td>
                                <td class="percentage medium">30.20%</td>
                                <td class="percentage low">12.60%</td>
                                <td class="percentage low">4.20%</td>
                                <td class="percentage low">1.80%</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="fund-portfolio-container"></div>
                </div>
            </div>

            <!-- λ²„νΌ μμ—­ -->
            <div class="button-container">
                <button class="page-btn btn-secondary">λ©λ΅μΌλ΅</button>
                <button class="page-btn btn-primary">κ°€μ…ν•κΈ°</button>
            </div>
        </div>
    </body>

    <script>
        // λ‹¨μΌ ν€λ“ μμµλ¥  λ°μ΄ν„° (μμ ν¬ν•¨ μμ‹)
        const fundData = {
            name: "μ‚Όμ„±μ¦κ¶ν¬μμ‹ νƒ",
            return_1m: -2.15, // μμ μμ‹
            return_3m: 15.42,
            return_6m: -5.23, // μμ μμ‹
            return_12m: 8.75,
        };

        let chart;

        // μμµλ¥ μ— λ”°λ¥Έ μƒ‰μƒ κ²°μ • (μ–‘μ=νλ€μƒ‰, μμ=λΉ¨κ°„μƒ‰)
        function getColor(value) {
            if (value >= 0) {
                return "rgba(54, 162, 235, 0.8)"; // μ–‘μ - νλ€μƒ‰
            } else {
                return "rgba(255, 99, 132, 0.8)"; // μμ - λΉ¨κ°„μƒ‰
            }
        }

        // ν…λ‘λ¦¬ μƒ‰μƒ (λ°°κ²½μƒ‰λ³΄λ‹¤ μ§„ν•κ²)
        function getBorderColor(value) {
            if (value >= 0) {
                return "rgba(54, 162, 235, 1)"; // μ–‘μ - μ§„ν• νλ€μƒ‰
            } else {
                return "rgba(255, 99, 132, 1)"; // μμ - μ§„ν• λΉ¨κ°„μƒ‰
            }
        }

        // μ°¨νΈ μ΄κΈ°ν™”
        function initChart() {
            const ctx = document.getElementById("fundChart").getContext("2d");

            const returns = [
                fundData.return_1m,
                fundData.return_3m,
                fundData.return_6m,
                fundData.return_12m,
            ];

            chart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: ["1κ°μ›”", "3κ°μ›”", "6κ°μ›”", "12κ°μ›”"],
                    datasets: [
                        {
                            label: "μμµλ¥  (%)",
                            data: returns,
                            backgroundColor: returns.map(getColor),
                            borderColor: returns.map(getBorderColor),
                            barPercentage: 0.5, // λ§‰λ€ λ„λΉ„ λΉ„μ¨ (0-1)
                            borderSkipped: "bottom",
                            // borderWidth: 2,
                            // borderRadius: 4,
                            // borderSkipped: false,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: "κΈ°κ°„λ³„ μμµλ¥  (%)",
                            font: {
                                size: 16,
                                weight: "bold",
                            },
                            padding: {
                                top: 10,
                                bottom: 20,
                            },
                        },
                        legend: {
                            display: false, // λ‹¨μΌ λ°μ΄ν„°μ…‹μ΄λ―€λ΅ λ²”λ΅€ μ¨κΉ€
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const value = context.parsed.y;
                                    return `μμµλ¥ : ${
                                        value >= 0 ? "+" : ""
                                    }${value.toFixed(2)}%`;
                                },
                                afterLabel: function (context) {
                                    const value = context.parsed.y;
                                    if (value > 0) return "π”µ μμµ";
                                    if (value < 0) return "π”΄ μ†μ‹¤";
                                    return "β– λ³€λ™ μ—†μ";
                                },
                            },
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: "μμµλ¥  (%)",
                                font: {
                                    size: 14,
                                    weight: "bold",
                                },
                            },
                            grid: {
                                color: "rgba(0,0,0,0.1)",
                                drawBorder: false,
                            },
                            ticks: {
                                callback: function (value) {
                                    return value + "%";
                                },
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: "ν¬μ κΈ°κ°„",
                                font: {
                                    size: 14,
                                    weight: "bold",
                                },
                            },
                            grid: {
                                display: false,
                            },
                        },
                    },
                    animation: {
                        duration: 1500,
                        easing: "easeInOutQuart",
                    },
                    interaction: {
                        intersect: false,
                        mode: "index",
                    },
                },
            });
        }

        // μ‹¤μ  λ°μ΄ν„°λ΅ μ°¨νΈ μ—…λ°μ΄νΈν•λ” ν•¨μ
        function updateChart(newFundData) {
            const returns = [
                newFundData.return_1m || newFundData.return1m,
                newFundData.return_3m || newFundData.return3m,
                newFundData.return_6m || newFundData.return6m,
                newFundData.return_12m || newFundData.return12m,
            ];

            // ν€λ“ μ •λ³΄ μ—…λ°μ΄νΈ
            document.getElementById("fundInfo").textContent = `ν€λ“λ…: ${
                newFundData.name || newFundData.fundName || "ν€λ“"
            }`;

            // μ°¨νΈ λ°μ΄ν„° μ—…λ°μ΄νΈ
            chart.data.datasets[0].data = returns;
            chart.data.datasets[0].backgroundColor = returns.map(getColor);
            chart.data.datasets[0].borderColor = returns.map(getBorderColor);

            chart.update("active");
        }

        // νμ΄μ§€ λ΅λ“ μ‹ μ°¨νΈ μ΄κΈ°ν™”
        window.onload = function () {
            initChart();
        };

        // μ™Έλ¶€μ—μ„ μ‚¬μ©ν•  μ μλ” μ „μ—­ ν•¨μ
        window.updateFundChart = updateChart;
    </script>
</html>
