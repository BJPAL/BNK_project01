<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>펀드 상세 정보</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: Arial, sans-serif;
                background-color: #f8f9fa;
                color: #333;
                line-height: 1.6;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }

            .header {
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
            }

            .fund-title {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 10px;
                color: #333;
            }

            .fund-info {
                display: flex;
                gap: 20px;
                flex-wrap: wrap;
            }

            .info-item {
                display: flex;
                flex-direction: column;
            }

            .info-label {
                font-size: 12px;
                color: #666;
                margin-bottom: 4px;
            }

            .info-value {
                font-size: 14px;
                font-weight: 500;
            }

            .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-bottom: 20px;
            }

            .card {
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .card-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 15px;
                color: #333;
                border-bottom: 2px solid #e9ecef;
                padding-bottom: 8px;
            }

            .price-section {
                text-align: center;
            }

            .current-price {
                font-size: 32px;
                font-weight: bold;
                color: #333;
                margin-bottom: 10px;
            }

            .price-change {
                font-size: 16px;
                font-weight: 500;
            }

            .price-change.positive {
                color: #dc3545;
            }

            .price-change.negative {
                color: #007bff;
            }

            .price-details {
                margin-top: 20px;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .asset-composition {
                margin-top: 10px;
            }

            .asset-item {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #e9ecef;
            }

            .asset-item:last-child {
                border-bottom: none;
            }

            .asset-bar {
                width: 100%;
                height: 20px;
                background-color: #e9ecef;
                border-radius: 10px;
                overflow: hidden;
                margin-top: 5px;
            }

            .asset-fill {
                height: 100%;
                background-color: #6c757d;
                transition: width 0.3s ease;
            }

            .detail-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-top: 15px;
            }

            .detail-item {
                display: flex;
                justify-content: space-between;
                padding: 10px;
                background-color: #f8f9fa;
                border-radius: 4px;
            }

            .loading {
                text-align: center;
                padding: 40px;
                color: #666;
            }

            .error {
                text-align: center;
                padding: 40px;
                color: #dc3545;
                background-color: #f8d7da;
                border-radius: 8px;
                margin: 20px 0;
            }

            @media (max-width: 768px) {
                .grid {
                    grid-template-columns: 1fr;
                }

                .fund-info {
                    flex-direction: column;
                    gap: 10px;
                }

                .price-details {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div id="loading" class="loading">펀드 정보를 불러오는 중...</div>

            <div id="error" class="error" style="display: none">
                펀드 정보를 불러올 수 없습니다.
            </div>

            <div id="content" style="display: none">
                <!-- 펀드 기본 정보 헤더 -->
                <div class="header">
                    <div class="fund-title" id="fundName">-</div>
                    <div class="fund-info">
                        <div class="info-item">
                            <span class="info-label">운용사</span>
                            <span class="info-value" id="managementCompany"
                                >-</span
                            >
                        </div>
                        <div class="info-item">
                            <span class="info-label">펀드유형</span>
                            <span class="info-value" id="fundType">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">투자지역</span>
                            <span class="info-value" id="investmentRegion"
                                >-</span
                            >
                        </div>
                        <div class="info-item">
                            <span class="info-label">위험등급</span>
                            <span class="info-value" id="riskLevel">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">펀드상태</span>
                            <span class="info-value" id="fundStatus">-</span>
                        </div>
                    </div>
                </div>

                <!-- 가격 정보 & 자산 구성 -->
                <div class="grid">
                    <!-- 현재 가격 정보 -->
                    <div class="card">
                        <div class="card-title">현재 가격 정보</div>
                        <div class="price-section">
                            <div class="current-price" id="basePrice">-</div>
                            <div class="price-change" id="priceChange">-</div>
                            <div class="price-details">
                                <div class="info-item">
                                    <span class="info-label">기준일</span>
                                    <span class="info-value" id="baseDate"
                                        >-</span
                                    >
                                </div>
                                <div class="info-item">
                                    <span class="info-label">순자산(억원)</span>
                                    <span class="info-value" id="aum">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">펀드규모</span>
                                    <span class="info-value" id="fundScale"
                                        >-</span
                                    >
                                </div>
                                <div class="info-item">
                                    <span class="info-label">기준통화</span>
                                    <span class="info-value" id="baseCurrency"
                                        >-</span
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 자산 구성 -->
                    <div class="card">
                        <div class="card-title">자산 구성</div>
                        <div class="asset-composition" id="assetComposition">
                            <!-- 자산 구성이 여기에 동적으로 추가됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 상세 정보 -->
                <div class="card">
                    <div class="card-title">상세 정보</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span>설정일</span>
                            <span id="establishDate">-</span>
                        </div>
                        <div class="detail-item">
                            <span>총 보수율</span>
                            <span id="totalExpenseRatio">-</span>
                        </div>
                        <div class="detail-item">
                            <span>클래스 유형</span>
                            <span id="classType">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // 현재 URL에서 fundId 추출 (예: /fund-detail.html?fundId=1)
            const urlParams = new URLSearchParams(window.location.search);
            const fundId = urlParams.get("fundId") || 1; // 기본값 1

            // API 기본 URL (환경에 맞게 수정)
            const API_BASE_URL = "http://localhost:8090/api";

            // 펀드 상세 정보 로드
            async function loadFundDetail() {
                try {
                    console.log(`API 요청: ${API_BASE_URL}/funds/${fundId}`);
                    const response = await fetch(
                        `${API_BASE_URL}/funds/${fundId}`
                    );

                    console.log("응답 상태:", response.status);
                    console.log("응답 헤더:", response.headers);

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.log("에러 응답:", errorText);
                        throw new Error(
                            `펀드 정보를 찾을 수 없습니다. (${response.status})`
                        );
                    }

                    const data = await response.json();
                    console.log("받은 데이터:", data);
                    displayFundDetail(data);
                } catch (error) {
                    console.error("Error loading fund detail:", error);
                    showError(error.message);
                }
            }

            // 펀드 상세 정보 화면에 표시
            function displayFundDetail(fund) {
                // 기본 정보
                document.getElementById("fundName").textContent =
                    fund.fundName || "-";
                document.getElementById("managementCompany").textContent =
                    fund.managementCompany || "-";
                document.getElementById("fundType").textContent =
                    fund.fundType || "-";
                document.getElementById("investmentRegion").textContent =
                    fund.investmentRegion || "-";
                document.getElementById("riskLevel").textContent =
                    fund.riskLevel ? `${fund.riskLevel}등급` : "-";
                document.getElementById("fundStatus").textContent =
                    fund.fundStatus || "-";

                // 가격 정보 (일단 하드코딩으로 대체)
                document.getElementById("basePrice").textContent = "1,461원";
                document.getElementById("priceChange").textContent =
                    "+0.58원 (+0.04%)";
                document.getElementById("priceChange").className =
                    "price-change positive";
                document.getElementById("baseDate").textContent = "2024-07-16";
                document.getElementById("aum").textContent = "767억원";
                document.getElementById("fundScale").textContent = "525";
                document.getElementById("baseCurrency").textContent =
                    fund.baseCurrency || "-";

                // 상세 정보
                document.getElementById("establishDate").textContent =
                    fund.establishDate || "-";
                document.getElementById("totalExpenseRatio").textContent =
                    fund.totalExpenseRatio ? `${fund.totalExpenseRatio}%` : "-";
                document.getElementById("classType").textContent =
                    fund.classType || "-";

                // 자산 구성 (간단 버전)
                displayAssetComposition(fund);

                // 로딩 숨기고 컨텐츠 표시
                document.getElementById("loading").style.display = "none";
                document.getElementById("content").style.display = "block";
            }

            // 자산 구성 표시 (간단 버전)
            function displayAssetComposition(fund) {
                const container = document.getElementById("assetComposition");

                const assets = [
                    { name: "국내 주식", value: fund.domesticStock },
                    { name: "해외 주식", value: fund.overseasStock },
                    { name: "국내 채권", value: fund.domesticBond },
                    { name: "해외 채권", value: fund.overseasBond },
                    { name: "펀드 투자", value: fund.fundInvestment },
                    { name: "유동성", value: fund.liquidity },
                ];

                // 0이 아닌 자산만 표시
                const nonZeroAssets = assets.filter(
                    (asset) => asset.value && asset.value > 0
                );

                if (nonZeroAssets.length === 0) {
                    container.innerHTML =
                        '<div class="asset-item"><span>자산 구성 정보가 없습니다.</span></div>';
                    return;
                }

                container.innerHTML = nonZeroAssets
                    .map(
                        (asset) => `
            <div class="asset-item">
                <span>${asset.name}</span>
                <span>${asset.value}%</span>
            </div>
            <div class="asset-bar">
                <div class="asset-fill" style="width: ${asset.value}%"></div>
            </div>
        `
                    )
                    .join("");
            }

            // 에러 표시
            function showError(message = "펀드 정보를 불러올 수 없습니다.") {
                document.getElementById("loading").style.display = "none";
                const errorElement = document.getElementById("error");
                errorElement.textContent = message;
                errorElement.style.display = "block";
            }

            // 페이지 로드 시 펀드 정보 불러오기
            document.addEventListener("DOMContentLoaded", loadFundDetail);
        </script>
    </body>
</html>
